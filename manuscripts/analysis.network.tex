\hypertarget{graph-data}{%
\subsubsection{Graph data}\label{graph-data}}

Loading resources:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Data manipulation}
\KeywordTok{library}\NormalTok{(tidyverse)}
\KeywordTok{library}\NormalTok{(igraph)}
\KeywordTok{library}\NormalTok{(magrittr)}
\KeywordTok{library}\NormalTok{(fuzzyjoin)}

\CommentTok{# Plotting dependencies}
\KeywordTok{library}\NormalTok{(scatterpie)}
\KeywordTok{library}\NormalTok{(UpSetR)}
\KeywordTok{library}\NormalTok{(gridExtra)}
\KeywordTok{library}\NormalTok{(patchwork)}

\CommentTok{# Utils}
\KeywordTok{library}\NormalTok{(neurotransmissionevolution)}

\CommentTok{# Packaged data}
\KeywordTok{data}\NormalTok{(}
\NormalTok{   gene_ids}
\NormalTok{  ,gene_cogs}
\NormalTok{  ,gene_pathways}
\NormalTok{  ,string_edgelist}
\NormalTok{  ,}\DataTypeTok{package =} \StringTok{"neurotransmissionevolution"}
\NormalTok{)}

\CommentTok{# Fresh analysis data}
\NormalTok{cog_roots                   <-}\StringTok{ }\KeywordTok{read_tsv}\NormalTok{(}\StringTok{"geneplast_roots.tsv"}\NormalTok{,             }\DataTypeTok{col_types =} \StringTok{"ci"}\NormalTok{)}
\NormalTok{clade_names                 <-}\StringTok{ }\KeywordTok{read_tsv}\NormalTok{(}\StringTok{"geneplast_clade_names.tsv"}\NormalTok{,       }\DataTypeTok{col_types =} \StringTok{"ic"}\NormalTok{)}
\NormalTok{pathway_neuroexclusivity    <-}\StringTok{ }\KeywordTok{read_tsv}\NormalTok{(}\StringTok{"neuroexclusivity_pathway.tsv"}\NormalTok{,    }\DataTypeTok{col_types =} \StringTok{"cn"}\NormalTok{)}
\NormalTok{expression_neuroexclusivity <-}\StringTok{ }\KeywordTok{read_tsv}\NormalTok{(}\StringTok{"neuroexclusivity_expression.tsv"}\NormalTok{, }\DataTypeTok{col_types =} \StringTok{"cn"}\NormalTok{)}

\CommentTok{# Collapsing similar functions}
\NormalTok{gene_annotation <-}\StringTok{ }\KeywordTok{read_tsv}\NormalTok{(}\StringTok{"../data/gene_annotation.tsv"}\NormalTok{, }\DataTypeTok{col_types =} \StringTok{"cc"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{annotation =} \KeywordTok{case_when}\NormalTok{(}
     \KeywordTok{grepl}\NormalTok{(}\StringTok{"clearance"}\NormalTok{,   annotation) }\OperatorTok{~}\StringTok{ "depletion"}
\NormalTok{    ,}\KeywordTok{grepl}\NormalTok{(}\StringTok{"degradation"}\NormalTok{, annotation) }\OperatorTok{~}\StringTok{ "depletion"}
\NormalTok{    ,}\KeywordTok{grepl}\NormalTok{(}\StringTok{"transport"}\NormalTok{,   annotation) }\OperatorTok{~}\StringTok{ "synthesis"}
\NormalTok{    ,}\OtherTok{TRUE} \OperatorTok{~}\StringTok{ }\NormalTok{annotation}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

We start by joining all gene data and creating the graph object.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# If a gene has more than 1 COG, select the most recent one.}
\NormalTok{gene_cogs }\OperatorTok{%<>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(cog_roots) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(string_id) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(root }\OperatorTok{==}\StringTok{ }\KeywordTok{min}\NormalTok{(root)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(clade_names)}

\CommentTok{# Gathering all gene info available}
\NormalTok{vertices <-}\StringTok{ }\NormalTok{gene_ids }\OperatorTok{%>%}
\StringTok{  }\NormalTok{na.omit }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(gene_cogs) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(gene_pathways) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(gene_annotation) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(pathway_neuroexclusivity) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(expression_neuroexclusivity) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{ne =}\NormalTok{ pathway_neuroexclusivity }\OperatorTok{>=}\StringTok{ }\FloatTok{0.9}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(string_id, }\KeywordTok{everything}\NormalTok{())}

\CommentTok{# Quick color hack to aid visualization}
\NormalTok{vertices }\OperatorTok{%<>%}
\StringTok{  }\KeywordTok{unite}\NormalTok{(color, glutamatergic}\OperatorTok{:}\NormalTok{dopaminergic, }\DataTypeTok{remove =}\NormalTok{ F) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{color =} \KeywordTok{rainbow}\NormalTok{(color }\OperatorTok{%>%}\StringTok{ }\NormalTok{n_distinct)[color }\OperatorTok{%>%}\StringTok{ }\NormalTok{as.factor])}

\NormalTok{g <-}\StringTok{ }\KeywordTok{graph_from_data_frame}\NormalTok{(string_edgelist, }\DataTypeTok{directed =}\NormalTok{ F, }\DataTypeTok{vertices =}\NormalTok{ vertices)}

\CommentTok{# Setting node sizes}
\KeywordTok{V}\NormalTok{(g)}\OperatorTok{$}\NormalTok{size <-}\StringTok{ }\KeywordTok{V}\NormalTok{(g)}\OperatorTok{$}\NormalTok{system_count }\OperatorTok{%>%}\StringTok{ }\NormalTok{sqrt }\OperatorTok{%>%}\StringTok{ }\KeywordTok{multiply_by}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

The following block calls an utility function that handles the force
directed layout with the aid of a shiny web server and the VivaGraphJS
javascript library. A computed layout is already available in this
folder.

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{if}\NormalTok{(}\KeywordTok{file.exists}\NormalTok{(}\StringTok{"network_layout.tsv"}\NormalTok{)) \{}
\NormalTok{  layout <-}\StringTok{ }\KeywordTok{read_tsv}\NormalTok{(}\StringTok{"network_layout.tsv"}\NormalTok{, }\DataTypeTok{col_types =} \StringTok{"dd"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\NormalTok{as.matrix}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
\NormalTok{  layout <-}\StringTok{ }\KeywordTok{vivagraph}\NormalTok{(g, }\DataTypeTok{precompute_multiplier =} \DecValTok{200}\NormalTok{, }\DataTypeTok{precompute_niter =} \DecValTok{1000}\NormalTok{)}
\NormalTok{\}}

\CommentTok{# inserting layout coordinates into graph object}
\KeywordTok{V}\NormalTok{(g)}\OperatorTok{$}\NormalTok{x <-}\StringTok{  }\NormalTok{layout[, }\DecValTok{1}\NormalTok{]}
\CommentTok{# layout matrix comes vertically flipped}
\KeywordTok{V}\NormalTok{(g)}\OperatorTok{$}\NormalTok{y <-}\StringTok{ }\OperatorTok{-}\NormalTok{layout[, }\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

We use base ggplot2 to draw the network. Edges are represented by a
common \texttt{geom\_path} layer. The following block retrieves tidy
edge coordinates for the \texttt{geom\_path} calls. We also perform some
data wrangling necessary for faceting the network plots according to the
roots of genes.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Recreating the vertices data.frame, now with layout coordinates (lazy way)}
\NormalTok{vertices <-}\StringTok{ }\NormalTok{g }\OperatorTok{%>%}
\StringTok{  }\NormalTok{igraph}\OperatorTok{::}\KeywordTok{as_data_frame}\NormalTok{(}\DataTypeTok{what =} \StringTok{"vertices"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{rename}\NormalTok{(}\DataTypeTok{string_id =}\NormalTok{ name) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{pie_border =} \OtherTok{NA}\NormalTok{)}

\CommentTok{# The edges data.frames will be used to draw lines with geom_path}
\NormalTok{edges_scaffold <-}\StringTok{ }\NormalTok{string_edgelist }\OperatorTok{%$%}
\StringTok{  }\KeywordTok{data.frame}\NormalTok{(}
     \DataTypeTok{string_id        =} \KeywordTok{c}\NormalTok{(stringId_A, stringId_B)}
\NormalTok{    ,}\DataTypeTok{group            =} \DecValTok{1}\OperatorTok{:}\KeywordTok{nrow}\NormalTok{(.)}
\NormalTok{    ,}\DataTypeTok{stringsAsFactors =} \OtherTok{FALSE}
\NormalTok{  )}

\NormalTok{edges <-}\StringTok{ }\NormalTok{edges_scaffold }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Joining vertices to obtain coordinates}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(vertices, }\DataTypeTok{by =} \StringTok{"string_id"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }
\StringTok{  }\CommentTok{# Determining from which root onwards an edge can be drawn}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(group) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{edge_root =} \KeywordTok{min}\NormalTok{(root))}

\CommentTok{# Reference data.frame for inequality join}
\NormalTok{subsequent_duplicator <-}\StringTok{ }\NormalTok{vertices }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{distinct}\NormalTok{(root) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(clade_names) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{transmute}\NormalTok{(}
     \DataTypeTok{facet_root =}\NormalTok{ root}
\NormalTok{    ,}\DataTypeTok{root_name  =} \KeywordTok{paste0}\NormalTok{(}\StringTok{"Human-"}\NormalTok{, clade_name, }\StringTok{" LCA (#"}\NormalTok{, root,}\StringTok{")"}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{fct_reorder}\NormalTok{(}\OperatorTok{-}\NormalTok{root)}
\NormalTok{  )}

\CommentTok{# Simply duplicating emerging edges in subsequent roots}
\NormalTok{edges_in_roots <-}\StringTok{ }\NormalTok{edges }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{fuzzy_inner_join}\NormalTok{(subsequent_duplicator, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"edge_root"}\NormalTok{ =}\StringTok{ "facet_root"}\NormalTok{), }\DataTypeTok{match_fun =} \KeywordTok{list}\NormalTok{(}\StringTok{`}\DataTypeTok{>=}\StringTok{`}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{past =}\NormalTok{ edge_root }\OperatorTok{!=}\StringTok{ }\NormalTok{facet_root)}

\CommentTok{# Simply duplicating emerging nodes in subsequent roots}
\NormalTok{nodes_in_roots <-}\StringTok{ }\NormalTok{vertices }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{fuzzy_inner_join}\NormalTok{(subsequent_duplicator, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"root"}\NormalTok{ =}\StringTok{ "facet_root"}\NormalTok{), }\DataTypeTok{match_fun =} \KeywordTok{list}\NormalTok{(}\StringTok{`}\DataTypeTok{>=}\StringTok{`}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
     \DataTypeTok{past        =}\NormalTok{ root }\OperatorTok{!=}\StringTok{ }\NormalTok{facet_root}
\NormalTok{    ,}\DataTypeTok{node_fill   =} \KeywordTok{ifelse}\NormalTok{(past, }\StringTok{"past"}\NormalTok{, annotation)}
\NormalTok{    ,}\DataTypeTok{node_border =} \KeywordTok{ifelse}\NormalTok{(}\OperatorTok{!}\NormalTok{past }\OperatorTok{&}\StringTok{ }\NormalTok{ne, }\StringTok{"ne_border"}\NormalTok{, node_fill)}
\NormalTok{    ,}\DataTypeTok{pie_border  =} \KeywordTok{ifelse}\NormalTok{(past, }\StringTok{"past"}\NormalTok{, }\KeywordTok{ifelse}\NormalTok{(ne, }\StringTok{"ne_border"}\NormalTok{, }\StringTok{"no_border"}\NormalTok{))}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

Setting up reusable aesthetic parameters to avoid code duplication.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{systems <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}
   \StringTok{"cholinergic"}
\NormalTok{  ,}\StringTok{"dopaminergic"}
\NormalTok{  ,}\StringTok{"gabaergic"}
\NormalTok{  ,}\StringTok{"glutamatergic"}
\NormalTok{  ,}\StringTok{"serotonergic"}
\NormalTok{)}

\NormalTok{edge_color <-}\StringTok{ }\KeywordTok{rgb}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\FloatTok{0.7}\NormalTok{, }\DataTypeTok{alpha =} \FloatTok{0.3}\NormalTok{)}

\NormalTok{color_mappings <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}
  \CommentTok{#----- neurotransmitter systems ----}
   \StringTok{"cholinergic"}\NormalTok{           =}\StringTok{ "#D84315"}
\NormalTok{  ,}\StringTok{"dopaminergic"}\NormalTok{          =}\StringTok{ "#F9A825"}
\NormalTok{  ,}\StringTok{"gabaergic"}\NormalTok{             =}\StringTok{ "#558B2F"}
\NormalTok{  ,}\StringTok{"glutamatergic"}\NormalTok{         =}\StringTok{ "#1565C0"}
\NormalTok{  ,}\StringTok{"serotonergic"}\NormalTok{          =}\StringTok{ "#6A1B9A"}
  \CommentTok{#--- neurotransmission functions ---}
\NormalTok{  ,}\StringTok{"depletion"}\NormalTok{             =}\StringTok{ "#F40000"}
\NormalTok{  ,}\StringTok{"excitability"}\NormalTok{          =}\StringTok{ "#FFAB00"}
\NormalTok{  ,}\StringTok{"receptor-associated"}\NormalTok{   =}\StringTok{ "#D6EE00"}
\NormalTok{  ,}\StringTok{"ionotropic receptor"}\NormalTok{   =}\StringTok{ "#43FF1C"}
\NormalTok{  ,}\StringTok{"metabotropic receptor"}\NormalTok{ =}\StringTok{ "#18FFFF"}
\NormalTok{  ,}\StringTok{"signaling"}\NormalTok{             =}\StringTok{ "#0091EA"}
\NormalTok{  ,}\StringTok{"g-protein"}\NormalTok{             =}\StringTok{ "#0033ff"}
\NormalTok{  ,}\StringTok{"synthesis"}\NormalTok{             =}\StringTok{ "#AA00FF"}
\NormalTok{  ,}\StringTok{"vesicle"}\NormalTok{               =}\StringTok{ "#FF00AA"}
  \CommentTok{#------- is_neuroexclusive ---------}
\NormalTok{  ,}\StringTok{"TRUE"}\NormalTok{                  =}\StringTok{ "#00BFC4"}
\NormalTok{  ,}\StringTok{"FALSE"}\NormalTok{                 =}\StringTok{ "#F8766D"}
  \CommentTok{#-------- network faceting ---------}
\NormalTok{  ,}\StringTok{"past"}\NormalTok{                  =}\StringTok{ "#FFFFFF"}
\NormalTok{  ,}\StringTok{"other"}\NormalTok{                 =}\StringTok{ "#A0A0A0"}
\NormalTok{  ,}\StringTok{"other_edge"}\NormalTok{            =}\StringTok{ "#B3B3B3"}
\NormalTok{  ,}\StringTok{"ne_border"}\NormalTok{             =}\StringTok{ "#000000"}
\NormalTok{)}

\CommentTok{# Some recurrent ggplot aesthetics}
\NormalTok{edge_aes <-}\StringTok{ }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y, }\DataTypeTok{group =}\NormalTok{ group)}
\NormalTok{pie_aes  <-}\StringTok{ }\KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y, }\DataTypeTok{color =}\NormalTok{ pie_border, }\DataTypeTok{group =}\NormalTok{ string_id, }\DataTypeTok{r =}\NormalTok{ size}\OperatorTok{^}\NormalTok{(}\FloatTok{0.94}\NormalTok{) }\OperatorTok{-}\StringTok{ }\FloatTok{1.5}\NormalTok{)}

\NormalTok{theme_facet <-}\StringTok{ }\KeywordTok{list}\NormalTok{(}
   \CommentTok{# Scales}
   \KeywordTok{scale_fill_manual}\NormalTok{(}\DataTypeTok{values =}\NormalTok{ color_mappings)}
\NormalTok{  ,}\KeywordTok{scale_color_manual}\NormalTok{(}\DataTypeTok{values =}\NormalTok{ color_mappings }\OperatorTok{%>%}\StringTok{ }\KeywordTok{darken}\NormalTok{(}\FloatTok{0.25}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"no_border"}\NormalTok{ =}\StringTok{ }\OtherTok{NA}\NormalTok{), }\DataTypeTok{guide =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{  ,}\KeywordTok{scale_shape_manual}\NormalTok{(}\DataTypeTok{values =} \KeywordTok{c}\NormalTok{(}\StringTok{"TRUE"}\NormalTok{ =}\StringTok{ "square filled"}\NormalTok{, }\StringTok{"FALSE"}\NormalTok{ =}\StringTok{ "circle filled"}\NormalTok{), }\DataTypeTok{guide =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{  ,}\KeywordTok{coord_equal}\NormalTok{()}
  \CommentTok{# Theme}
\NormalTok{  ,}\KeywordTok{theme_void}\NormalTok{()}
\NormalTok{  ,}\KeywordTok{theme}\NormalTok{(}
     \DataTypeTok{strip.text       =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{margin =} \KeywordTok{margin}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{10}\NormalTok{))}
\NormalTok{    ,}\DataTypeTok{strip.text.x     =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#616161"}\NormalTok{, }\DataTypeTok{size =} \DecValTok{10}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{strip.background =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#E0E0E0"}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"#E0E0E0"}\NormalTok{, }\DataTypeTok{size =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"solid"}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{panel.border     =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#E0E0E0"}\NormalTok{, }\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{size =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"solid"}\NormalTok{)}
\NormalTok{  )}
\NormalTok{  ,}\KeywordTok{guides}\NormalTok{(}\DataTypeTok{legend.position=}\StringTok{"none"}\NormalTok{)}
\NormalTok{  ,}\KeywordTok{guides}\NormalTok{(}\DataTypeTok{fill =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{color =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{linetype =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{shape =} \OtherTok{FALSE}\NormalTok{, }\DataTypeTok{size =} \OtherTok{FALSE}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{manuscript-figure-1}{%
\subsubsection{Manuscript figure 1}\label{manuscript-figure-1}}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Common elements}
\NormalTok{plot_edges <-}\StringTok{ }\KeywordTok{geom_path}\NormalTok{(}
   \DataTypeTok{data    =}\NormalTok{ edges}
\NormalTok{  ,}\DataTypeTok{mapping =}\NormalTok{ edge_aes}
\NormalTok{  ,}\DataTypeTok{color   =}\NormalTok{ edge_color}
\NormalTok{  ,}\DataTypeTok{size    =} \FloatTok{0.1}
\NormalTok{)}

\NormalTok{plot_text <-}\StringTok{ }\KeywordTok{geom_text}\NormalTok{(}
   \DataTypeTok{data    =}\NormalTok{ vertices}
\NormalTok{  ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(x, y, }\DataTypeTok{label =}\NormalTok{ string_name)}
\NormalTok{  ,}\DataTypeTok{size    =} \FloatTok{1.5}
\NormalTok{  ,}\DataTypeTok{vjust   =} \DecValTok{0}
\NormalTok{  ,}\DataTypeTok{nudge_y =} \DecValTok{6}
\NormalTok{  ,}\DataTypeTok{alpha   =} \FloatTok{0.5}
\NormalTok{)}

\CommentTok{# Figure 1A}
\NormalTok{plot_pies <-}\StringTok{ }\KeywordTok{geom_scatterpie}\NormalTok{(}
   \DataTypeTok{data    =}\NormalTok{ vertices}
\NormalTok{  ,}\DataTypeTok{mapping =}\NormalTok{ pie_aes}
\NormalTok{  ,}\DataTypeTok{cols    =}\NormalTok{ systems}
\NormalTok{)}

\NormalTok{fig1a <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\NormalTok{plot_edges }\OperatorTok{+}
\StringTok{  }\NormalTok{plot_pies }\OperatorTok{+}
\StringTok{  }\NormalTok{theme_facet }\OperatorTok{+}
\StringTok{  }\NormalTok{plot_text }\OperatorTok{+}
\StringTok{  }\KeywordTok{guides}\NormalTok{(}\DataTypeTok{fill=}\StringTok{"legend"}\NormalTok{)}

\CommentTok{# Figure 1B}
\NormalTok{plot_nodes <-}\StringTok{ }\KeywordTok{geom_point}\NormalTok{(}
   \DataTypeTok{data    =}\NormalTok{ vertices}
\NormalTok{  ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(x, y, }\DataTypeTok{fill =}\NormalTok{ annotation, }\DataTypeTok{color =}\NormalTok{ annotation, }\DataTypeTok{size =}\NormalTok{ size)}
\NormalTok{  ,}\DataTypeTok{shape   =} \DecValTok{21}
\NormalTok{  ,}\DataTypeTok{stroke  =} \DecValTok{1}
\NormalTok{)}
  
\NormalTok{fig1b <-}\StringTok{ }\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\NormalTok{plot_edges }\OperatorTok{+}
\StringTok{  }\NormalTok{plot_nodes }\OperatorTok{+}
\StringTok{  }\NormalTok{theme_facet }\OperatorTok{+}
\StringTok{  }\NormalTok{plot_text }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_radius}\NormalTok{(}\DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\FloatTok{1.5}\NormalTok{, }\FloatTok{4.5}\NormalTok{), }\DataTypeTok{guide =} \OtherTok{FALSE}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\KeywordTok{guides}\NormalTok{(}\DataTypeTok{fill=}\StringTok{"legend"}\NormalTok{)}

\CommentTok{# Plotting and saving}
\NormalTok{fig1a }\OperatorTok{/}\StringTok{ }\NormalTok{fig1b}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{figs/analysis.network.fig1-1} 

}

\caption{Unedited manuscript figure 1. The human neurotransmission network with nodes colored by neurotransmitter systems (top) and neurotransmission functions (bottom).}\label{fig:fig1}
\end{figure}

\hypertarget{manuscript-figure-2}{%
\subsubsection{Manuscript figure 2}\label{manuscript-figure-2}}

This figure is produced externally by a program called ViaComplex, which
superimposes a heatmap over the network layout based on a node property.
In our case, this property is the neuroexclusivity index. The following
block handles data formatting related to ViaComplex.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Retrieving the largest connected component}
\NormalTok{subgraphs <-}\StringTok{ }\KeywordTok{decompose.graph}\NormalTok{(g)}
\NormalTok{lcc_index <-}\StringTok{ }\KeywordTok{which.max}\NormalTok{(}\KeywordTok{sapply}\NormalTok{(subgraphs, vcount))}
\NormalTok{lcc       <-}\StringTok{ }\NormalTok{subgraphs[[lcc_index]]}

\CommentTok{# Writing network data to viacomplex's custom format (similar to pajek)}
\CommentTok{# xy_hack adds some extra margin to the plot}
\NormalTok{xy_hack <-}\StringTok{ }\KeywordTok{data.frame}\NormalTok{(}
   \DataTypeTok{name                        =} \KeywordTok{c}\NormalTok{(}\StringTok{"top"}\NormalTok{, }\StringTok{"bot"}\NormalTok{)}
\NormalTok{  ,}\DataTypeTok{x                           =} \KeywordTok{range}\NormalTok{(}\KeywordTok{V}\NormalTok{(lcc)}\OperatorTok{$}\NormalTok{x) }\OperatorTok{+}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{75}\NormalTok{, }\DecValTok{75}\NormalTok{)}
\NormalTok{  ,}\DataTypeTok{y                           =} \KeywordTok{range}\NormalTok{(}\KeywordTok{V}\NormalTok{(lcc)}\OperatorTok{$}\NormalTok{y) }\OperatorTok{+}\StringTok{ }\KeywordTok{c}\NormalTok{(}\OperatorTok{-}\DecValTok{75}\NormalTok{, }\DecValTok{75}\NormalTok{)}
\NormalTok{  ,}\DataTypeTok{pathway_neuroexclusivity    =} \DecValTok{0}
\NormalTok{  ,}\DataTypeTok{expression_neuroexclusivity =} \DecValTok{0}
\NormalTok{  ,}\DataTypeTok{stringsAsFactors            =}\NormalTok{ F}
\NormalTok{)}

\NormalTok{pajek_nodes <-}\StringTok{ }\NormalTok{lcc }\OperatorTok{%>%}
\StringTok{  }\NormalTok{igraph}\OperatorTok{::}\KeywordTok{as_data_frame}\NormalTok{(}\StringTok{"vertices"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{bind_rows}\NormalTok{(xy_hack) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{id =} \KeywordTok{row_number}\NormalTok{(), }\DataTypeTok{y =} \OperatorTok{-}\NormalTok{y)}

\NormalTok{pajek_edges <-}\StringTok{ }\NormalTok{igraph}\OperatorTok{::}\KeywordTok{as_data_frame}\NormalTok{(lcc, }\StringTok{"edges"}\NormalTok{)}

\CommentTok{# Creating the network_viacomplex.net file and sequentially populating it}
\KeywordTok{write}\NormalTok{(}\StringTok{"*edges"}\NormalTok{, }\StringTok{"network_viacomplex.net"}\NormalTok{)}
\KeywordTok{write_tsv}\NormalTok{(}
   \DataTypeTok{x            =}\NormalTok{ pajek_edges}
\NormalTok{  ,}\DataTypeTok{path         =} \StringTok{"network_viacomplex.net"}
\NormalTok{  ,}\DataTypeTok{append       =}\NormalTok{ T}
\NormalTok{  ,}\DataTypeTok{col_names    =}\NormalTok{ F}
\NormalTok{  ,}\DataTypeTok{quote_escape =}\NormalTok{ F}
\NormalTok{)}
\KeywordTok{write}\NormalTok{(}\StringTok{"*nodes"}\NormalTok{, }\StringTok{"network_viacomplex.net"}\NormalTok{, }\DataTypeTok{append =}\NormalTok{ T)}
\KeywordTok{write_tsv}\NormalTok{(}
   \DataTypeTok{x            =}\NormalTok{ pajek_nodes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(name, x, y)}
\NormalTok{  ,}\DataTypeTok{path         =} \StringTok{"network_viacomplex.net"}
\NormalTok{  ,}\DataTypeTok{append       =}\NormalTok{ T}
\NormalTok{  ,}\DataTypeTok{col_names    =}\NormalTok{ F}
\NormalTok{  ,}\DataTypeTok{quote_escape =}\NormalTok{ F}
\NormalTok{)}

\KeywordTok{write_tsv}\NormalTok{(}
   \DataTypeTok{x    =}\NormalTok{ pajek_nodes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(id, name, pathway_neuroexclusivity)}
\NormalTok{  ,}\DataTypeTok{path =} \StringTok{"network_viacomplex_pathway.dat"}
\NormalTok{)}
\KeywordTok{write_tsv}\NormalTok{(}
   \DataTypeTok{x    =}\NormalTok{ pajek_nodes }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(id, name, expression_neuroexclusivity)}
\NormalTok{  ,}\DataTypeTok{path =} \StringTok{"network_viacomplex_expression.dat"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{manuscript-figure-3}{%
\subsubsection{Manuscript figure 3}\label{manuscript-figure-3}}

The process for generating Figures 3 and 4 is roughly the same. It
consists of finding what nodes have numeric roots in a given range. In
our analysis, the largest root is numbered 37 and represents the oldest
common ancestor to humans in the cladogram (the Human-Metamonada LCA, as
seen in previous sections). Root number 1 is represented by \emph{Homo
sapiens} itself.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Subsetting node data for the two roots}
\NormalTok{nodes_in_roots_fig3 <-}\StringTok{ }\NormalTok{nodes_in_roots }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{filter}\NormalTok{(facet_root }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{37}\NormalTok{,}\DecValTok{26}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
     \CommentTok{# Correctly color coding every node between these roots}
     \DataTypeTok{past        =}\NormalTok{ (root }\OperatorTok{==}\StringTok{ }\DecValTok{37}\NormalTok{) }\OperatorTok{&}\StringTok{ }\NormalTok{(root }\OperatorTok{!=}\StringTok{ }\NormalTok{facet_root)}
\NormalTok{    ,}\DataTypeTok{pie_border  =} \KeywordTok{ifelse}\NormalTok{(past, }\StringTok{"past"}\NormalTok{, }\KeywordTok{ifelse}\NormalTok{(ne, }\StringTok{"ne_border"}\NormalTok{, }\StringTok{"no_border"}\NormalTok{))}
\NormalTok{  )}

\CommentTok{# Nodes from root 37 should be white in root 26}
\NormalTok{nodes_in_roots_fig3[nodes_in_roots_fig3[[}\StringTok{"past"}\NormalTok{]], systems] <-}\StringTok{ }\DecValTok{0}

\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\CommentTok{# Edges}
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ edges_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(facet_root }\OperatorTok{%in%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\DecValTok{37}\NormalTok{,}\DecValTok{26}\NormalTok{))}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ edge_aes}
\NormalTok{    ,}\DataTypeTok{color   =}\NormalTok{ edge_color}
\NormalTok{    ,}\DataTypeTok{size    =} \FloatTok{0.1}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Non-neuroexclusive nodes}
\StringTok{  }\KeywordTok{geom_scatterpie}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ nodes_in_roots_fig3 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(ne }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ pie_aes}
\NormalTok{    ,}\DataTypeTok{cols    =}\NormalTok{ systems }\OperatorTok{%>%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"past"}\NormalTok{)}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Neuroexclusive nodes}
\StringTok{  }\KeywordTok{geom_scatterpie}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ nodes_in_roots_fig3 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(ne }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ pie_aes}
\NormalTok{    ,}\DataTypeTok{cols    =}\NormalTok{ systems }\OperatorTok{%>%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"past"}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{n       =} \DecValTok{5} \CommentTok{# Square nodes}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{geom_text}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ nodes_in_roots_fig3 }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(past }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y }\OperatorTok{+}\StringTok{ }\KeywordTok{linMap}\NormalTok{(system_count, }\DecValTok{10}\NormalTok{, }\DecValTok{16}\NormalTok{), }\DataTypeTok{label =}\NormalTok{ string_name)}
\NormalTok{    ,}\DataTypeTok{size    =} \FloatTok{1.5}
\NormalTok{    ,}\DataTypeTok{alpha   =} \FloatTok{0.5}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(. }\OperatorTok{~}\StringTok{ }\NormalTok{root_name, }\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\NormalTok{theme_facet}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{figs/analysis.network.fig3-1} 

}

\caption{Unedited manuscript figure 3. It represents the human neurotransmission network with nodes colored by neurotransmitter systems. At the top, we have the human network composed only of nodes rooted at the origin of Eukaryota. At the bottom, we have the human network composed of nodes rooted since the origin of Eukaryota until the Human-Cnidaria LCA.}\label{fig:fig3}
\end{figure}

Additionally, we cumulatively count nodes by their categories (function
and neuroexclusivity) and inferred root:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cumulative_emergence <-}\StringTok{ }\NormalTok{vertices }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{select}\NormalTok{(root, annotation, }\DataTypeTok{is_neuroexclusive =}\NormalTok{ ne) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Adding clade info}
\StringTok{  }\KeywordTok{right_join}\NormalTok{(clade_names) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Converting logical to character}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{is_neuroexclusive =} \KeywordTok{as.character}\NormalTok{(is_neuroexclusive)) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Pivoting from wide to long}
\StringTok{  }\KeywordTok{pivot_longer}\NormalTok{(annotation}\OperatorTok{:}\NormalTok{is_neuroexclusive, }\DataTypeTok{values_ptypes =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{value =} \StringTok{"character"}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Counting nodes by category (name) for each root}
\StringTok{  }\KeywordTok{count}\NormalTok{(root, clade_name, name, value) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Making absent counts explicit}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(name) }\OperatorTok{%>%}
\StringTok{  }\NormalTok{tidyr}\OperatorTok{::}\KeywordTok{complete}\NormalTok{(}\KeywordTok{nesting}\NormalTok{(root, clade_name), name, value, }\DataTypeTok{fill =} \KeywordTok{list}\NormalTok{(}\DataTypeTok{n =} \DecValTok{0}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# No reason to include NA observations in cumulative sum}
\StringTok{  }\NormalTok{na.omit }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Cumulative sum node count at each root}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(name, value) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}\DataTypeTok{cumulative_count =} \KeywordTok{order_by}\NormalTok{(}\OperatorTok{-}\NormalTok{root, }\KeywordTok{cumsum}\NormalTok{(n)))}
\end{Highlighting}
\end{Shaded}

Plotting such cumulative counts:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Creating ordered factors for plotting}
\NormalTok{cumulative_emergence }\OperatorTok{%<>%}\StringTok{ }\NormalTok{ungroup }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
     \DataTypeTok{clade_name =} \KeywordTok{fct_reorder}\NormalTok{(clade_name, }\OperatorTok{-}\NormalTok{root)}
\NormalTok{    ,}\DataTypeTok{value      =} \KeywordTok{fct_reorder}\NormalTok{(value, name)}
\NormalTok{  )}

\KeywordTok{ggplot}\NormalTok{(cumulative_emergence) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Barplot}
\StringTok{  }\KeywordTok{geom_bar}\NormalTok{(}
     \DataTypeTok{mapping     =} \KeywordTok{aes}\NormalTok{(clade_name, cumulative_count, }\DataTypeTok{group =}\NormalTok{ value)}
\NormalTok{    ,}\DataTypeTok{stat        =} \StringTok{"sum"}
\NormalTok{    ,}\DataTypeTok{fill        =} \StringTok{"#999999"}
\NormalTok{    ,}\DataTypeTok{show.legend =}\NormalTok{ F}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Lines}
\StringTok{  }\KeywordTok{geom_line}\NormalTok{(}
     \DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(clade_name, cumulative_count, }\DataTypeTok{group =}\NormalTok{ value, }\DataTypeTok{color =}\NormalTok{ value)}
\NormalTok{    ,}\DataTypeTok{size    =} \DecValTok{1}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Styling}
\StringTok{  }\KeywordTok{scale_color_manual}\NormalTok{(}\DataTypeTok{values =}\NormalTok{ color_mappings) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_grid}\NormalTok{(name }\OperatorTok{~}\StringTok{ }\NormalTok{.) }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}
     \DataTypeTok{axis.title  =} \KeywordTok{element_blank}\NormalTok{()}
\NormalTok{    ,}\DataTypeTok{axis.text.x =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{size =} \DecValTok{12}\NormalTok{, }\DataTypeTok{angle =} \DecValTok{-45}\NormalTok{, }\DataTypeTok{vjust =} \DecValTok{0}\NormalTok{, }\DataTypeTok{hjust =} \DecValTok{0}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{figs/analysis.network.fig3_barplots-1} 

}

\caption{Cumulative node counts by categories at each root.}\label{fig:fig3_barplots}
\end{figure}

\hypertarget{manuscript-figure-4}{%
\subsubsection{Manuscript figure 4}\label{manuscript-figure-4}}

Visualizing nodes with roots \textless= 30 (Human-Porifera LCA) and
\textgreater= 26 (Human-Cnidaria LCA) at every distinct root.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\CommentTok{# Edges}
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ edges_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(facet_root }\OperatorTok{>=}\StringTok{ }\DecValTok{26} \OperatorTok{&}\StringTok{ }\NormalTok{facet_root }\OperatorTok{<=}\StringTok{ }\DecValTok{30}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ edge_aes}
\NormalTok{    ,}\DataTypeTok{color   =}\NormalTok{ edge_color}
\NormalTok{    ,}\DataTypeTok{size    =} \FloatTok{0.1}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Nodes}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}
     \DataTypeTok{data =}\NormalTok{ nodes_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(facet_root }\OperatorTok{>=}\StringTok{ }\DecValTok{26} \OperatorTok{&}\StringTok{ }\NormalTok{facet_root }\OperatorTok{<=}\StringTok{ }\DecValTok{30}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}
       \DataTypeTok{x     =}\NormalTok{ x}
\NormalTok{      ,}\DataTypeTok{y     =}\NormalTok{ y}
\NormalTok{      ,}\DataTypeTok{size  =}\NormalTok{ size}
\NormalTok{      ,}\DataTypeTok{shape =}\NormalTok{ ne}
\NormalTok{      ,}\DataTypeTok{fill  =}\NormalTok{ node_fill}
\NormalTok{      ,}\DataTypeTok{color =}\NormalTok{ node_border}
\NormalTok{    )}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Labels}
\StringTok{  }\KeywordTok{geom_text}\NormalTok{(}
     \DataTypeTok{data =}\NormalTok{ nodes_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(past }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE} \OperatorTok{&}\StringTok{ }\NormalTok{facet_root }\OperatorTok{>=}\StringTok{ }\DecValTok{26} \OperatorTok{&}\StringTok{ }\NormalTok{facet_root }\OperatorTok{<=}\StringTok{ }\DecValTok{30}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y }\OperatorTok{+}\StringTok{ }\KeywordTok{linMap}\NormalTok{(system_count, }\DecValTok{10}\NormalTok{, }\DecValTok{16}\NormalTok{), }\DataTypeTok{label =}\NormalTok{ string_name)}
\NormalTok{    ,}\DataTypeTok{size =} \DecValTok{2}
\NormalTok{    ,}\DataTypeTok{alpha =} \FloatTok{0.75}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_radius}\NormalTok{(}\DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\FloatTok{1.75}\NormalTok{, }\FloatTok{4.5}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(. }\OperatorTok{~}\StringTok{ }\NormalTok{root_name, }\DataTypeTok{ncol =} \DecValTok{5}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\NormalTok{theme_facet}
\end{Highlighting}
\end{Shaded}

\begin{figure}

{\centering \includegraphics{figs/analysis.network.fig4-1} 

}

\caption{Unedited manuscript figure 4. The human neurotransmission network composed of nodes rooted between roots 30 (Holozoa LCA) and 26 (Human-Cnidaria LCA).}\label{fig:fig4}
\end{figure}

\hypertarget{supplementary-network-figures}{%
\subsubsection{Supplementary network
figures}\label{supplementary-network-figures}}

The following supplementary figures help us see what nodes have been
rooted at each LCA. Nodes from previous roots are colored white.

\begin{Shaded}
\begin{Highlighting}[]
\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\CommentTok{# Edges}
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ edges_in_roots}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ edge_aes}
\NormalTok{    ,}\DataTypeTok{color   =}\NormalTok{ edge_color}
\NormalTok{    ,}\DataTypeTok{size    =} \FloatTok{0.1}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Nodes}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}
     \DataTypeTok{data =}\NormalTok{ nodes_in_roots}
\NormalTok{    ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}
       \DataTypeTok{x     =}\NormalTok{ x}
\NormalTok{      ,}\DataTypeTok{y     =}\NormalTok{ y}
\NormalTok{      ,}\DataTypeTok{size  =}\NormalTok{ size}
\NormalTok{      ,}\DataTypeTok{shape =}\NormalTok{ ne}
\NormalTok{      ,}\DataTypeTok{fill  =}\NormalTok{ node_fill}
\NormalTok{      ,}\DataTypeTok{color =}\NormalTok{ node_border}
\NormalTok{    )}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Labels}
\StringTok{  }\KeywordTok{geom_text}\NormalTok{(}
     \DataTypeTok{data =}\NormalTok{ nodes_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(past }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y }\OperatorTok{+}\StringTok{ }\KeywordTok{linMap}\NormalTok{(system_count, }\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{), }\DataTypeTok{label =}\NormalTok{ string_name)}
\NormalTok{    ,}\DataTypeTok{size =} \FloatTok{1.15}
\NormalTok{    ,}\DataTypeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_radius}\NormalTok{(}\DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\FloatTok{1.5}\NormalTok{, }\FloatTok{3.5}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(. }\OperatorTok{~}\StringTok{ }\NormalTok{root_name, }\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\NormalTok{theme_facet}
\end{Highlighting}
\end{Shaded}

\clearpage

\thispagestyle{empty}

\pdfpageheight=102in

\begin{figure}[p]

\caption{The human neurotransmission network with nodes rooted at each human LCA. Nodes are colored according to their function in neurotransmission. Nodes from previous roots are colored white. Nodes with black borders are neuroexclusive.}\label{fig:analysis.network.wrap_functions-1}

{\centering \includegraphics[height=100in, width=6.9in]{figs/analysis.network.wrap_functions-1} }

\end{figure}

\clearpage

\pdfpageheight=11in

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Past nodes should be white (ie have no systems)}
\NormalTok{nodes_in_roots[nodes_in_roots[[}\StringTok{"past"}\NormalTok{]], systems] <-}\StringTok{ }\DecValTok{0}

\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\CommentTok{# Edges}
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ edges_in_roots}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ edge_aes}
\NormalTok{    ,}\DataTypeTok{color   =}\NormalTok{ edge_color}
\NormalTok{    ,}\DataTypeTok{size    =} \FloatTok{0.1}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Non-neuroexclusive nodes}
\StringTok{  }\KeywordTok{geom_scatterpie}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ nodes_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(ne }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ pie_aes}
\NormalTok{    ,}\DataTypeTok{cols    =}\NormalTok{ systems }\OperatorTok{%>%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"past"}\NormalTok{)}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Neuroexclusive nodes}
\StringTok{  }\KeywordTok{geom_scatterpie}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ nodes_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(ne }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ pie_aes}
\NormalTok{    ,}\DataTypeTok{cols    =}\NormalTok{ systems }\OperatorTok{%>%}\StringTok{ }\KeywordTok{c}\NormalTok{(}\StringTok{"past"}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{n       =} \DecValTok{5} \CommentTok{# Square nodes}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Labels}
\StringTok{  }\KeywordTok{geom_text}\NormalTok{(}
     \DataTypeTok{data =}\NormalTok{ nodes_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(past }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y }\OperatorTok{+}\StringTok{ }\KeywordTok{linMap}\NormalTok{(system_count, }\DecValTok{10}\NormalTok{, }\DecValTok{16}\NormalTok{), }\DataTypeTok{label =}\NormalTok{ string_name)}
\NormalTok{    ,}\DataTypeTok{size =} \FloatTok{2.25}
\NormalTok{    ,}\DataTypeTok{alpha =} \FloatTok{0.5}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_wrap}\NormalTok{(. }\OperatorTok{~}\StringTok{ }\NormalTok{root_name, }\DataTypeTok{ncol =} \DecValTok{1}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\NormalTok{theme_facet }\OperatorTok{+}
\StringTok{  }\KeywordTok{theme}\NormalTok{(}
     \DataTypeTok{strip.text       =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{margin =} \KeywordTok{margin}\NormalTok{(}\DecValTok{20}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{20}\NormalTok{))}
\NormalTok{    ,}\DataTypeTok{strip.text.x     =} \KeywordTok{element_text}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#616161"}\NormalTok{, }\DataTypeTok{size =} \DecValTok{20}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{strip.background =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#E0E0E0"}\NormalTok{, }\DataTypeTok{fill =} \StringTok{"#E0E0E0"}\NormalTok{, }\DataTypeTok{size =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"solid"}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{panel.border     =} \KeywordTok{element_rect}\NormalTok{(}\DataTypeTok{color =} \StringTok{"#E0E0E0"}\NormalTok{, }\DataTypeTok{fill =} \OtherTok{NA}\NormalTok{, }\DataTypeTok{size =} \FloatTok{0.5}\NormalTok{, }\DataTypeTok{linetype =} \StringTok{"solid"}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\clearpage

\thispagestyle{empty}

\pdfpageheight=102in

\begin{figure}[p]

\caption{The human neurotransmission network with nodes rooted at each human LCA. Nodes are colored according to their neurotransmitter systems. Nodes from previous roots are colored white. Nodes with black borders are neuroexclusive.}\label{fig:analysis.network.wrap_systems-1}

{\centering \includegraphics[height=100in, width=6.9in]{figs/analysis.network.wrap_systems-1} }

\end{figure}

\clearpage

\pdfpageheight=11in

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{# Pivoting vertices data.frame to enable faceting by systems}
\NormalTok{vertices_long <-}\StringTok{ }\KeywordTok{pivot_longer}\NormalTok{(}
   \DataTypeTok{data      =}\NormalTok{ vertices}
\NormalTok{  ,}\DataTypeTok{cols      =} \KeywordTok{all_of}\NormalTok{(systems)}
\NormalTok{  ,}\DataTypeTok{names_to  =} \StringTok{"system"}
\NormalTok{  ,}\DataTypeTok{values_to =} \StringTok{"is_system"}
\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
     \DataTypeTok{system_color     =} \KeywordTok{ifelse}\NormalTok{(is_system,     system, }\StringTok{"other"}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{annotation_color =} \KeywordTok{ifelse}\NormalTok{(is_system, annotation, }\StringTok{"other"}\NormalTok{)}
\NormalTok{  )}

\NormalTok{edges_systems <-}\StringTok{ }\NormalTok{edges_scaffold }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{inner_join}\NormalTok{(vertices_long, }\DataTypeTok{by =} \StringTok{"string_id"}\NormalTok{) }\OperatorTok{%>%}
\StringTok{  }\CommentTok{# Determines from which root onwards and edge can be drawn (as well as its color)}
\StringTok{  }\KeywordTok{group_by}\NormalTok{(group, system) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
     \DataTypeTok{edge_system =} \KeywordTok{ifelse}\NormalTok{(is_system[}\KeywordTok{which.min}\NormalTok{(root)], system, }\StringTok{"other_edge"}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{edge_root   =} \KeywordTok{min}\NormalTok{(root)}
\NormalTok{  )}

\CommentTok{# Simply duplicating emerging edges in subsequent roots}
\NormalTok{edges_in_roots <-}\StringTok{ }\NormalTok{edges_systems }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{fuzzy_inner_join}\NormalTok{(subsequent_duplicator, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"edge_root"}\NormalTok{ =}\StringTok{ "facet_root"}\NormalTok{), }\DataTypeTok{match_fun =} \KeywordTok{list}\NormalTok{(}\StringTok{`}\DataTypeTok{>=}\StringTok{`}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
     \DataTypeTok{past =}\NormalTok{ edge_root }\OperatorTok{!=}\StringTok{ }\NormalTok{facet_root}
\NormalTok{    ,}\DataTypeTok{edge_color =} \KeywordTok{ifelse}\NormalTok{(}\OperatorTok{!}\NormalTok{past }\OperatorTok{&}\StringTok{ }\NormalTok{(system_color }\OperatorTok{==}\StringTok{ }\NormalTok{edge_system), system, }\StringTok{"other_edge"}\NormalTok{)}
\NormalTok{  )}

\CommentTok{# Simply duplicating emerging nodes in subsequent roots}
\NormalTok{nodes_in_roots <-}\StringTok{ }\NormalTok{vertices_long }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{fuzzy_inner_join}\NormalTok{(subsequent_duplicator, }\DataTypeTok{by =} \KeywordTok{c}\NormalTok{(}\StringTok{"root"}\NormalTok{ =}\StringTok{ "facet_root"}\NormalTok{), }\DataTypeTok{match_fun =} \KeywordTok{list}\NormalTok{(}\StringTok{`}\DataTypeTok{>=}\StringTok{`}\NormalTok{)) }\OperatorTok{%>%}
\StringTok{  }\KeywordTok{mutate}\NormalTok{(}
     \DataTypeTok{past              =}\NormalTok{ root }\OperatorTok{!=}\StringTok{ }\NormalTok{facet_root}
\NormalTok{    ,}\DataTypeTok{system_color      =} \KeywordTok{ifelse}\NormalTok{(past, }\StringTok{"past"}\NormalTok{, system_color)}
\NormalTok{    ,}\DataTypeTok{system_border     =} \KeywordTok{ifelse}\NormalTok{(}\OperatorTok{!}\NormalTok{past }\OperatorTok{&}\StringTok{ }\NormalTok{ne, }\StringTok{"ne_border"}\NormalTok{, system_color)}
\NormalTok{    ,}\DataTypeTok{annotation_border =} \KeywordTok{ifelse}\NormalTok{(}\OperatorTok{!}\NormalTok{past }\OperatorTok{&}\StringTok{ }\NormalTok{ne, }\StringTok{"ne_border"}\NormalTok{, annotation_color)}
\NormalTok{  )}

\KeywordTok{ggplot}\NormalTok{() }\OperatorTok{+}
\StringTok{  }\CommentTok{# Edges}
\StringTok{  }\KeywordTok{geom_path}\NormalTok{(}
     \DataTypeTok{data    =}\NormalTok{ edges_in_roots}
\NormalTok{    ,}\DataTypeTok{mapping =}\NormalTok{ edge_aes}
\NormalTok{    ,}\DataTypeTok{color   =}\NormalTok{ color_mappings[edges_in_roots[[}\StringTok{"edge_color"}\NormalTok{]]] }\OperatorTok{%>%}\StringTok{ }\KeywordTok{alpha}\NormalTok{(}\FloatTok{0.3}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{size    =} \FloatTok{0.1}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Nodes}
\StringTok{  }\KeywordTok{geom_point}\NormalTok{(}
     \DataTypeTok{data =}\NormalTok{ nodes_in_roots }
\NormalTok{    ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}
       \DataTypeTok{x     =}\NormalTok{ x}
\NormalTok{      ,}\DataTypeTok{y     =}\NormalTok{ y}
\NormalTok{      ,}\DataTypeTok{size  =}\NormalTok{ size}
\NormalTok{      ,}\DataTypeTok{shape =}\NormalTok{ ne}
\NormalTok{      ,}\DataTypeTok{fill  =}\NormalTok{ system_color}
\NormalTok{      ,}\DataTypeTok{color =}\NormalTok{ system_border}
\NormalTok{    )}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\CommentTok{# Labels}
\StringTok{  }\KeywordTok{geom_text}\NormalTok{(}
     \DataTypeTok{data =}\NormalTok{ nodes_in_roots }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(past }\OperatorTok{==}\StringTok{ }\OtherTok{FALSE} \OperatorTok{&}\StringTok{ }\NormalTok{is_system }\OperatorTok{==}\StringTok{ }\OtherTok{TRUE}\NormalTok{)}
\NormalTok{    ,}\DataTypeTok{mapping =} \KeywordTok{aes}\NormalTok{(}\DataTypeTok{x =}\NormalTok{ x, }\DataTypeTok{y =}\NormalTok{ y }\OperatorTok{+}\StringTok{ }\KeywordTok{linMap}\NormalTok{(system_count, }\DecValTok{10}\NormalTok{, }\DecValTok{16}\NormalTok{), }\DataTypeTok{label =}\NormalTok{ string_name)}
\NormalTok{    ,}\DataTypeTok{size =} \FloatTok{1.5}
\NormalTok{    ,}\DataTypeTok{alpha =} \FloatTok{0.75}
\NormalTok{  ) }\OperatorTok{+}
\StringTok{  }\KeywordTok{scale_radius}\NormalTok{(}\DataTypeTok{range =} \KeywordTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)) }\OperatorTok{+}
\StringTok{  }\KeywordTok{facet_grid}\NormalTok{(root_name }\OperatorTok{~}\StringTok{ }\NormalTok{system, }\DataTypeTok{switch =} \StringTok{"y"}\NormalTok{) }\OperatorTok{+}
\StringTok{  }\NormalTok{theme_facet}
\end{Highlighting}
\end{Shaded}

\clearpage

\thispagestyle{empty}

\pdfpagewidth=16.6in \pdfpageheight=37.6in

\begin{figure}[p]

\newgeometry{textwidth=15in}

\caption{The human neurotransmission network with nodes rooted at each human LCA. Nodes are colored according to their neurotransmitter systems. Nodes from previous roots are colored white. Nodes with black borders are neuroexclusive.}\label{fig:analysis.network.faceted_systems-1}

\restoregeometry

{\centering \includegraphics[height=35in, width=15in]{figs/analysis.network.faceted_systems-1} }

\end{figure}

\clearpage

\pdfpagewidth=8.5in \pdfpageheight=11in

\hypertarget{manuscript-set-diagrams}{%
\subsubsection{Manuscript set diagrams}\label{manuscript-set-diagrams}}

The following code block produces all set diagrams from the main
manuscript.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{upset_texts <-}\StringTok{ }\KeywordTok{c}\NormalTok{(}
   \DecValTok{2}   \CommentTok{#ytitle}
\NormalTok{  ,}\DecValTok{2}   \CommentTok{#ytick}
\NormalTok{  ,}\DecValTok{1}   \CommentTok{#setsizetitle}
\NormalTok{  ,}\FloatTok{1.5} \CommentTok{#setsizetick}
\NormalTok{  ,}\DecValTok{2}   \CommentTok{#setnames}
\NormalTok{  ,}\FloatTok{2.5} \CommentTok{#barnums}
\NormalTok{)}

\CommentTok{# We have to manually find the correct order of colors}
\CommentTok{# Because UpSetR does not understand named vectors}
\NormalTok{get_colors <-}\StringTok{ }\ControlFlowTok{function}\NormalTok{(df) \{}
\NormalTok{  ordered_systems <-}\StringTok{ }\NormalTok{df }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{select}\NormalTok{(systems) }\OperatorTok{%>%}
\StringTok{    }\NormalTok{colSums }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{extract}\NormalTok{(. }\OperatorTok{>}\StringTok{ }\DecValTok{0}\NormalTok{) }\OperatorTok{%>%}
\StringTok{    }\KeywordTok{extract}\NormalTok{(}\KeywordTok{order}\NormalTok{(., }\KeywordTok{names}\NormalTok{(.), }\DataTypeTok{decreasing =}\NormalTok{ T))}

\NormalTok{  color_mappings[}\KeywordTok{names}\NormalTok{(ordered_systems)]}
\NormalTok{\}}

\CommentTok{# Figure 1A set diagram}
\KeywordTok{upset}\NormalTok{(}
   \KeywordTok{select}\NormalTok{(vertices, systems)}
\NormalTok{  ,}\DataTypeTok{mb.ratio        =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.3}\NormalTok{)}
\NormalTok{  ,}\DataTypeTok{order.by        =} \StringTok{"freq"}
\NormalTok{  ,}\DataTypeTok{mainbar.y.label =} \StringTok{"System Intersections"}
\NormalTok{  ,}\DataTypeTok{sets.x.label    =} \StringTok{"Genes per system"}
\NormalTok{  ,}\DataTypeTok{text.scale      =}\NormalTok{ upset_texts}
\NormalTok{  ,}\DataTypeTok{point.size      =} \FloatTok{3.5}
\NormalTok{  ,}\DataTypeTok{line.size       =} \DecValTok{1}
\NormalTok{  ,}\DataTypeTok{sets.bar.color  =} \KeywordTok{get_colors}\NormalTok{(vertices)}
\NormalTok{)}
\KeywordTok{dev.print}\NormalTok{(pdf, }\StringTok{"plots/fig1a_set_raw.pdf"}\NormalTok{, }\DataTypeTok{width =} \DecValTok{18}\NormalTok{, }\DataTypeTok{height =} \DecValTok{10}\NormalTok{, }\DataTypeTok{onefile =}\NormalTok{ F, }\DataTypeTok{useDingbats =}\NormalTok{ F)}

\CommentTok{# Figure 3A set diagram}
\NormalTok{fig3a_set <-}\StringTok{ }\NormalTok{vertices }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(root }\OperatorTok{==}\StringTok{ }\DecValTok{37}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(systems)}
\KeywordTok{upset}\NormalTok{(}
\NormalTok{   fig3a_set}
\NormalTok{  ,}\DataTypeTok{mb.ratio        =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.3}\NormalTok{)}
\NormalTok{  ,}\DataTypeTok{order.by        =} \StringTok{"freq"}
\NormalTok{  ,}\DataTypeTok{mainbar.y.label =} \StringTok{"System Intersections"}
\NormalTok{  ,}\DataTypeTok{sets.x.label    =} \StringTok{"Genes per system"}
\NormalTok{  ,}\DataTypeTok{text.scale      =}\NormalTok{ upset_texts}
\NormalTok{  ,}\DataTypeTok{point.size      =} \FloatTok{3.5}
\NormalTok{  ,}\DataTypeTok{line.size       =} \DecValTok{1}
\NormalTok{  ,}\DataTypeTok{sets.bar.color  =} \KeywordTok{get_colors}\NormalTok{(fig3a_set)}
\NormalTok{)}
\KeywordTok{dev.print}\NormalTok{(pdf, }\StringTok{"plots/fig3a_set_raw.pdf"}\NormalTok{, }\DataTypeTok{width =} \DecValTok{16}\NormalTok{, }\DataTypeTok{height =} \DecValTok{8}\NormalTok{, }\DataTypeTok{onefile =}\NormalTok{ F, }\DataTypeTok{useDingbats =}\NormalTok{ F)}

\CommentTok{# Figure 3B set diagram}
\NormalTok{fig3b_set <-}\StringTok{ }\NormalTok{vertices }\OperatorTok{%>%}\StringTok{ }\KeywordTok{filter}\NormalTok{(root }\OperatorTok{<}\StringTok{ }\DecValTok{37} \OperatorTok{&}\StringTok{ }\NormalTok{root }\OperatorTok{>=}\StringTok{ }\DecValTok{26}\NormalTok{) }\OperatorTok{%>%}\StringTok{ }\KeywordTok{select}\NormalTok{(systems)}
\KeywordTok{upset}\NormalTok{(}
\NormalTok{   fig3b_set}
\NormalTok{  ,}\DataTypeTok{mb.ratio        =} \KeywordTok{c}\NormalTok{(}\FloatTok{0.7}\NormalTok{, }\FloatTok{0.3}\NormalTok{)}
\NormalTok{  ,}\DataTypeTok{order.by        =} \StringTok{"freq"}
\NormalTok{  ,}\DataTypeTok{mainbar.y.label =} \StringTok{"System Intersections"}
\NormalTok{  ,}\DataTypeTok{sets.x.label    =} \StringTok{"Genes per system"}
\NormalTok{  ,}\DataTypeTok{text.scale      =}\NormalTok{ upset_texts}
\NormalTok{  ,}\DataTypeTok{point.size      =} \FloatTok{3.5}
\NormalTok{  ,}\DataTypeTok{line.size       =} \DecValTok{1}
\NormalTok{  ,}\DataTypeTok{sets.bar.color  =} \KeywordTok{get_colors}\NormalTok{(fig3b_set)}
\NormalTok{)}
\KeywordTok{dev.print}\NormalTok{(pdf, }\StringTok{"plots/fig3b_set_raw.pdf"}\NormalTok{, }\DataTypeTok{width =} \DecValTok{16}\NormalTok{, }\DataTypeTok{height =} \DecValTok{8}\NormalTok{, }\DataTypeTok{onefile =}\NormalTok{ F, }\DataTypeTok{useDingbats =}\NormalTok{ F)}
\end{Highlighting}
\end{Shaded}

\begin{figure}
\subfloat[Set diagram for Figure 1A\label{fig:sets-1}]{\includegraphics{figs/analysis.network.sets-1} }\newline\subfloat[Set diagram for Figure 3A\label{fig:sets-2}]{\includegraphics{figs/analysis.network.sets-2} }\newline\subfloat[Set diagram for Figure 3B\label{fig:sets-3}]{\includegraphics{figs/analysis.network.sets-3} }\caption{Set diagrams}\label{fig:sets}
\end{figure}
