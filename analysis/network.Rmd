---
title: "Network"
output:
  html_document:
    df_print: paged
    theme: default
    highlight: espresso
    toc: true
    toc_depth: 2
    toc_float: true
    number_sections: true
---
# Intro
Obter o layout da rede no RedeR
```{r message=FALSE}
library(dplyr)
library(igraph)
library(magrittr)

library(Hmisc)
library(ggplot2)
library(scatterpie)
# library(UpSetR)
```

# Dados
```{r rows.print=5}
data(
  gene_ids,
  gene_pathways,
  string_edgelist,
  package = "neurotransmission"
)
```

# RedeR
```{r}
vertices <- gene_ids %>% na.omit %>% inner_join(gene_pathways) %>% select(string_id, everything())

# adapting to d3
vertices %<>% mutate(id = string_id)
string_edgelist %<>% rename(source = stringId_A, target = stringId_B)

g <- graph_from_data_frame(string_edgelist, directed = F, vertices = vertices)

V(g)$size <- V(g)$system_count * 5

subgraphs <- decompose.graph(g)
lcc <- subgraphs[[which.max(sapply(subgraphs, vcount))]]
```

# Force
```{r echo=T, eval=T, include=FALSE}
layout <- d3force(lcc)

vertices

sistemas <- c("glutamatergic","cholinergic","serotonergic","gabaergic","dopaminergic")

from <- gene_info[match(edgelist[,1], gene_info[,"protein_id"]), c("x","y")]
to <- gene_info[match(edgelist[,2], gene_info[,"protein_id"]), c("x","y")]

edges <- rbind(from, to) %>% cbind(group = 1:nrow(edgelist))
```

# Output
```{r}
ggplot() +
  geom_path(data = edges, aes(x = x, y = y, group = group), colour="#888888", size=0.1) +
  
  #piecharts
  geom_scatterpie(data = vertices, aes(x=x, y=y, group=protein_id, r=resize), cols = new_names, color=NA) +
  scale_fill_manual(values=pie_colors) +
  
  #labels
  geom_text(data = gene_info, aes(x=x, y=y, label=symbol, size=factor(size)), vjust = 0, nudge_y = gene_info[,"resize"]+6, alpha=0.75) +
  scale_size_manual(values=txtsize, guide = 'none') +
    
  ggtitle("Complete network") +
  coord_equal() +
  #guides(fill=FALSE) +
  theme_void()
```
